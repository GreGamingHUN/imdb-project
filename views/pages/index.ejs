<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('../partials/head') %> 
</head>
<body>
    <%- include('../partials/login') %>
    <%- include('../partials/navbar') %>
    <% if (alert != "") { %>
        <script>alert("'<%- alert %>'")</script>
        <% } %>
        <div class="main-container">
            <div class="movie-card-container"> 
                <% res.forEach(element => {              
                    let favourite = false;
                    if (res2 != undefined) {
                        res2.forEach(element2 => {
                            if (element2.movieid == element.movieid) favourite = true;
                        });
                    } else {
                        favourite = false;
                    } %> 
                    <div class="movie-card">
                        <div class="top"><img src="<%- element.path_to_img %>" alt="kep"></div>
                        <div class="bottom">
                            <% if (localStorage.getItem('loggedin') == "true") { %>  
                                <div class="favourite-container">
                                    <form action="favourite" method="post">
                                        <label>
                                            <input style="display: none;" name="movieid" type="submit" value="<%- element.movieid %> ">
                                            <svg width="20px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                                            viewBox="0 0 512.002 512.002" style="enable-background:new 0 0 512.002 512.002;" xml:space="preserve">
                                            <% if (favourite) { %>
                                                <path class="heart-fill-active" d="M255.998,474.506l201.958-201.958c26.556-26.556,41.182-61.909,41.182-99.558
                                                s-14.626-73.003-41.182-99.558c-26.59-26.598-61.943-41.242-99.558-41.242c-33.493,0-66.21,12.442-92.433,35.337l-9.967,9.327
                                                l-10.291-9.617C219.808,44.63,187.1,32.189,153.598,32.189c-37.615,0-72.969,14.643-99.558,41.242
                                                c-26.556,26.556-41.182,61.909-41.182,99.558S27.484,246,54.039,272.547L255.998,474.506z"/>
                                                <% } else { %>
                                                    <path class="heart-fill" d="M255.998,474.506l201.958-201.958c26.556-26.556,41.182-61.909,41.182-99.558
                                                    s-14.626-73.003-41.182-99.558c-26.59-26.598-61.943-41.242-99.558-41.242c-33.493,0-66.21,12.442-92.433,35.337l-9.967,9.327
                                                    l-10.291-9.617C219.808,44.63,187.1,32.189,153.598,32.189c-37.615,0-72.969,14.643-99.558,41.242
                                                    c-26.556,26.556-41.182,61.909-41.182,99.558S27.484,246,54.039,272.547L255.998,474.506z"/>
                                                    <% } %> 
                                                    <path style="fill:#573A32;" d="M255.998,492.613L467.01,281.601C527,221.612,527,124.366,467.01,64.377
                                                    c-29.995-29.995-69.299-44.988-108.612-44.988c-36.779,0-73.259,13.662-102.4,39.919c-29.15-26.257-65.621-39.919-102.4-39.919
                                                    c-39.313,0-78.618,14.993-108.612,44.988c-59.981,59.981-59.981,157.235,0,217.225L255.998,492.613z M63.085,82.476
                                                    c24.175-24.175,56.32-37.487,90.513-37.487c31.206,0,60.399,11.563,83.695,31.889l18.705,17.493l18.714-17.493
                                                    c23.296-20.318,52.489-31.889,83.686-31.889c34.193,0,66.33,13.312,90.513,37.487c49.911,49.903,49.903,131.115,0,181.018
                                                    L255.998,456.406L63.085,263.502C13.182,213.59,13.182,132.387,63.085,82.476z"/>
                                                </svg>
                                            </label>
                                        </form>
                                    </div>
                                    <% } %>
                                    <span class="movie-name"><%- element.movie_name %></span>
                                    <form method="post" action="details">
                                        <button value="<%- element.movieid %>" name="id" type="submit" class="details">Részletek</button>
                                    </form>
                                    <div class="rating-container">
                                        <% if (localStorage.getItem("loggedin") == "true") { %>
                                            <form action="deletemovie" method="post" style="position: absolute; right: 125px; bottom: 0px">
                                                <button class="delete-button" type="submit" name="movieid" value="<%- element.movieid %>">Törlés</button>
                                            </form>
                                        <% }%>
                                        <% if (element.user_rating) { %>
                                            <span class="user-rating"><%- element.user_rating / 2 %> ⭐</span>
                                            <% } %>
                                            <% if (element.rotten_tomatoes) { %>
                                                <span class="rotten-tomatoes"><%- element.rotten_tomatoes %>% </span>
                                                <% } %>
                                            </div>
                                        </div>
                                    </div>
                                    <% }) %>
                                    <% if (localStorage.getItem('loggedin') == "true") {%>
                                    <div class="movie-card">
                                        <div class="top"><img src="/img/cover/addnew.jpg" alt="kep"></div>
                                        <div class="bottom">
                                            <span class="movie-name"></span>
                                            <form method="get" action="addmovie">
                                                <button type="submit" class="details">Új film hozzáadása</button>
                                            </form>
                                        </div>
                                    </div>
                                    <% } %>
                                </div>
                            </div>
                        </body>
                        </html>